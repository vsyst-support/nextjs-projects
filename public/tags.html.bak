<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Tags</title>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        font-family: Arial, sans-serif;
        background: #f0f4f8;
      }

      #backBtn {
        display: block;
        margin: 15px 0 0 20px;
        text-decoration: none;
        color: #2196f3;
        font-weight: bold;
      }

      .container {
        width: 100%;
        height: calc(100% - 50px);
        box-sizing: border-box;
        padding: 30px;
        background: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-y: auto;
      }

      h2 {
        margin-bottom: 20px;
      }

      .tag-form {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
      }

      .tag-form input {
        padding: 10px 14px;
        border-radius: 14px;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      .tag-form button {
        padding: 8px 18px;
        border-radius: 8px;
        border: none;
        background: #2196f3;
        color: #fff;
        cursor: pointer;
      }

      .tag-list {
        width: 100%;
        max-width: 600px;
      }

      .tag-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 14px;
        margin-bottom: 10px;
        border-radius: 10px;
        background: #f9f9f9;
        border: 1px solid #ccc;
      }

      .tag-left {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .tag-pill {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 13px;
        color: #fff;
      }

      .tag-actions button {
        margin-left: 6px;
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 6px;
        cursor: pointer;
        background: transparent;
      }

      /* Common icon-style buttons */
      .edit-btn,
      .delete-btn,
      .save-edit-btn {
        background: transparent;
        border: 1.5px solid;
        padding: 6px 14px;
        border-radius: 8px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      /* Edit */
      .edit-btn {
        border-color: #2196f3;
        color: #2196f3;
      }

      /* Delete */
      .delete-btn {
        border-color: #f44336;
        color: #f44336;
      }

      /* Save (edit mode) */
      .save-edit-btn {
        border-color: #2196f3;
        color: #2196f3;
        font-weight: bold;
      }

      .edit-input {
        padding: 6px 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 13px;
      }
    </style>
  </head>

  <body>
    <a id="backBtn" href="index.html">â¬… Back to Clipboard</a>

    <div class="container">
      <h2>Create Tag</h2>

      <div class="tag-form">
        <input id="name" placeholder="Tag name" />
        <input id="color" type="color" value="#4caf50" />
        <span
          id="colorPreview"
          style="
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-left: 6px;
            vertical-align: middle;
            background: #4caf50;
          "
        ></span>

        <button onclick="saveTag()">Save</button>
      </div>

      <div class="tag-list" id="tagList"></div>
    </div>

    <script>
      // ===== Color preview for "Create Tag" form =====
      const colorInput = document.getElementById("color");
      const colorPreview = document.getElementById("colorPreview");

      // Update preview when the color picker changes
      colorInput.addEventListener("input", () => {
        colorPreview.style.background = colorInput.value;
      });

      // ===== Your existing functions =====
      async function saveTag() {
        const name = document.getElementById("name").value.trim();
        const color = colorInput.value;
        if (!name) return;

        await fetch("/api/tags", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, color }),
        });

        document.getElementById("name").value = "";
        loadTags();
      }

      async function loadTags() {
        /* ... rest of your loadTags code ... */
      }

      function startEdit(tag, row) {
        /* ... rest of your startEdit code ... */
      }

      loadTags();

      async function loadTags() {
        const res = await fetch("/api/tags");
        const tags = await res.json();
        const list = document.getElementById("tagList");

        list.innerHTML = "";

        tags.forEach((tag) => {
          const row = document.createElement("div");
          row.className = "tag-row";

          const left = document.createElement("div");
          left.className = "tag-left";

          const pill = document.createElement("span");
          pill.className = "tag-pill";
          pill.style.background = tag.color;
          pill.textContent = tag.name;

          left.appendChild(pill);

          const actions = document.createElement("div");
          actions.className = "tag-actions";

          const editBtn = document.createElement("button");
          editBtn.className = "edit-btn";
          editBtn.innerHTML = `
  <span style="display:flex;align-items:center;gap:6px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="#2196f3">
      <path d="M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04Z"/>
    </svg>
  </span>
`;

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "delete-btn";
          deleteBtn.innerHTML = `
  <span style="display:flex;align-items:center;gap:6px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="#f44336">
      <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M9,8H11V17H9V8M13,8H15V17H13V8Z"/>
    </svg>
  </span>
`;

          editBtn.onclick = () => startEdit(tag, row);
          deleteBtn.onclick = async () => {
            if (!confirm("Delete this tag?")) return;
            await fetch(`/api/tags/${tag._id}`, { method: "DELETE" });
            loadTags();
          };

          actions.append(editBtn, deleteBtn);
          row.append(left, actions);
          list.appendChild(row);
        });
      }

      function startEdit(tag, row) {
        row.innerHTML = "";

        // Name input
        const nameInput = document.createElement("input");
        nameInput.value = tag.name;
        nameInput.className = "edit-input";

        // Color input
        const colorInput = document.createElement("input");
        colorInput.type = "color";
        colorInput.value = tag.color;

        // Color preview for edit
        const colorPreview = document.createElement("span");
        colorPreview.style.display = "inline-block";
        colorPreview.style.width = "20px";
        colorPreview.style.height = "20px";
        colorPreview.style.borderRadius = "4px";
        colorPreview.style.border = "1px solid #ccc";
        colorPreview.style.marginLeft = "6px";
        colorPreview.style.verticalAlign = "middle";
        colorPreview.style.background = tag.color;

        // Update preview dynamically
        colorInput.addEventListener("input", () => {
          colorPreview.style.background = colorInput.value;
        });

        // Save button
        const saveBtn = document.createElement("button");
        saveBtn.className = "save-edit-btn";
        saveBtn.innerHTML = `Save`;

        saveBtn.onclick = async () => {
          await fetch(`/api/tags/${tag._id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              name: nameInput.value.trim(),
              color: colorInput.value,
            }),
          });
          loadTags();
        };

        // Append to row
        row.append(nameInput, colorInput, colorPreview, saveBtn);
      }

      loadTags();
    </script>
  </body>
</html>
